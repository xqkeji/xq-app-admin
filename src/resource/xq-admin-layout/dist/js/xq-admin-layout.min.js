/*!
 * xq-admin-layout v1.0.1 (https://xqkeji.cn/demo/xq-adminpage)
 * Author xqkeji.cn
 * LICENSE SSPL-1.0
 * Copyright 2023 xqkeji.cn
 */
 (function(){"use strict";const b=require("xq-util");const e="#xq-tab-fullscreen";const n="#xq-tab-left";const c="#xq-tab-right";const f="#xq-tab-nav";const m="#xq-tab-nav-ul";const d="#xq-tab-nav-ul>li>a.active";const o="#xq-tab-contentmenu";const s="#xq-tab-refresh";const l="#xq-tab-close-all";const r="#xq-tab-close-other";const y="#xq-sidebar";const t=".xq-fileinput";const i="#xq-top-nav";const a="mini";const u='[xq-widget="xq-mini-menu"]';const q="#xq-header";const C="#xq-content";const R="#xq-footer";const j=".xq-captcha";const S="#xq-tab-content";const z="#xq-tab-nav-ul .nav-item .nav-link button.close";const H="#xq-tab-nav-ul .nav-item .nav-link";const J="xq-menu";const v="bg-primary";const p="bg-dark";const g=".xq-logout";const L="bi-chevron-down";const x="bi-chevron-left";const _=()=>{const t=document.querySelector(j);if(t){t.addEventListener("click",t=>{const e=t.currentTarget;let n=e.getAttribute("src");if(n.includes("?")){n=n.slice(0,Math.max(0,n.lastIndexOf("?")));n=n+"?xq-r="+Math.random().toString()}else{n=n+"?xq-r="+Math.random().toString()}e.setAttribute("src",n)})}};const V=()=>{const e=document.querySelectorAll(t);if(e&&typeof jQuery!==void 0){let t;for(const n of e){t=n.hasAttribute("xq-config")?n.getAttribute("xq-config"):"{}";$(n).fileinput(JSON.parse(t)).on("filedeleted",t=>{const e=t.currentTarget;h(e)}).on("fileuploaded",t=>{const e=t.currentTarget;h(e)}).on("filesorted",t=>{const e=t.currentTarget;h(e)});h(n)}}};const h=t=>{const e=t.getAttribute("id");const n=e.replace("-xq-fileinput","");const c=document.querySelector("#"+n);const o=$(t).fileinput("getPreview");c?.setAttribute("value",JSON.stringify(o));const s=$(t).fileinput("getFilesCount",true);const l=t.getAttribute("xq-config");const r=JSON.parse(l);if("required"in r){if(s>0){t.removeAttribute("required")}else{t.setAttribute("required","true")}if("content"in o){const{content:i}=o;if(i.length===0){t.setCustomValidity("需要至少上传一个文件")}else{t.setCustomValidity("")}}}};const A=()=>{const t=document.querySelectorAll(g);if(t){for(const e of t){e.addEventListener("click",t=>{t.preventDefault();const e=t.currentTarget;const n=e.getAttribute("href");const c="xq-logout-form-"+Math.floor(Math.random()*1e3).toString();const o='<form action="'+n+'" method="post" style="display: none;" id="'+c+'"></form>';b.append(document.body,o);const s=document.querySelector("#"+c);s.submit()})}}};const k={scrollbarTheme:"os-theme-light",scrollbarAutoHide:"leave"};let E=null;const w=()=>{if(typeof OverlayScrollbars!=="undefined"){if(!E){E=OverlayScrollbars(document.querySelector(y),{className:k.scrollbarTheme,sizeAutoCapable:true,scrollbars:{autoHide:k.scrollbarAutoHide,clickScrolling:true}})}}};const P=()=>{if(E){E.destroy();E=null}};const Q=()=>{const t=document.querySelector(i);if(t!==null){const r=t.querySelectorAll("li a:not([xq-widget])");for(const e of r){e.addEventListener("click",t=>{t.preventDefault();const e=t.currentTarget;const n=e.getAttribute("href");const c=document.querySelector(n);if(c?.classList.contains("d-none")){for(const o of r){if(o!==e){if(!o.classList.contains("bg-dark")){o.classList.add("bg-dark")}if(o.classList.contains("bg-primary")){o.classList.remove("bg-primary")}const s=o.getAttribute("href");const l=document.querySelector(s);if(!l?.classList.contains("d-none")){l?.classList.add("d-none")}}else{if(o.classList.contains("bg-dark")){o.classList.remove("bg-dark")}if(!o.classList.contains("bg-primary")){o.classList.add("bg-primary")}const s=o.getAttribute("href");const l=document.querySelector(s);if(l?.classList.contains("d-none")){l?.classList.remove("d-none")}}}}})}}};const X=()=>{const t=document.querySelector(u);if(t){t.addEventListener("click",t=>{t.preventDefault();const e=document.querySelector(q);if(e){if(e.classList.contains(a)){e.classList.remove(a)}else{e.classList.add(a)}}const n=document.querySelector(y);if(n){if(n.classList.contains(a)){n.classList.remove(a);w()}else{n.classList.add(a);P()}}const c=document.querySelector(C);if(c){if(c.classList.contains(a)){c.classList.remove(a)}else{c.classList.add(a)}}const o=document.querySelector(R);if(o){if(o.classList.contains(a)){o.classList.remove(a)}else{o.classList.add(a)}}})}};const Y=t=>{let e=null;const n=document.querySelector(m);const c=n.querySelectorAll("li");for(const o of c){if(o===t){break}e=o}return e};const N=t=>{const e=document.querySelector(m);const n=document.querySelector(S);const c=e.querySelector("li > a#"+t+"-tab");if(c===null){return}const o=e.querySelector("li > a.active");if(o){o.classList.remove("active")}if(c){c.classList.add("active")}const s=n.querySelector("div.active");if(s){s.classList.remove("active")}const l=n.querySelector("#"+t+"-tab-content");if(l){l.classList.add("active")}B(t)};const B=e=>{const t=document.querySelector(f);const n=document.querySelector(m);const c=n.querySelector("li:first-child");const o=Number.isNaN(Number.parseInt(c.style.marginLeft,10))?0:Number.parseInt(c.style.marginLeft,10);const s=Math.abs(o);const l=n.clientWidth+s;const r=t.clientWidth;let i=0;if(l>r){const a=n.querySelector("#"+e+"-tab");const u=n.querySelectorAll("li>a");let t=0;for(const d of u){t+=d.clientWidth;if(d===a){break}}if(o+t>r){i=r-t;c.style.marginLeft=i<0?i.toString()+"px":"0px"}}else{c.style.marginLeft="0px"}};const G=()=>{const t=document.querySelectorAll(z);for(const e of t){T(e)}};const T=t=>{t.addEventListener("click",t=>{t.preventDefault();const e=document.querySelector(S);const n=t.currentTarget;const c=n.parentNode;const o=c.getAttribute("id");const s=o.replace("-tab","");const l=c?.parentNode;if(c.classList.contains("active")){const r=Y(l);const i=r.querySelector("a");const a=i.getAttribute("id");const u=a.replace("-tab","");l.remove();e.querySelector("#"+s+"-tab-content")?.remove();N(u)}else{l.remove();e.querySelector("#"+s+"-tab-content")?.remove();N(s)}})};const K=()=>{const t=document.querySelectorAll(H);for(const e of t){const n=e.getAttribute("id");if(n!==null){D(n.replace("-tab",""))}}};const D=t=>{const e=document.querySelector(m);const n=e.querySelector("li > a#"+t+"-tab");if(n){n.addEventListener("click",t=>{const e=t.currentTarget;const n=e.getAttribute("id");N(n.replace("-tab",""))})}};const F=t=>{if(t){const e=document.querySelector(m);const n=e.querySelectorAll("li a button.close");for(const r of n){r.click()}const c=e.querySelector("li:first-child");const o=c.querySelector("a");o?.classList.add("acitve");const s=o?.getAttribute("data-bs-target");const l=document.querySelector(s);if(l){l?.classList.add("acitve")}if(c){c.style.marginLeft="0px"}}else{const e=document.querySelector(m);const n=e.querySelectorAll("li a:not(.active)");for(const r of n){const u=r.querySelector("button.close");u.click()}const i=document.querySelector(d);i.classList.add("acitve");const a=i?.getAttribute("data-bs-target");const l=document.querySelector(a);const c=e.querySelector("li:first-child");if(l){l?.classList.add("acitve")}if(c){c.style.marginLeft="0px"}}};const W=t=>{t.addEventListener("contextmenu",t=>{t.preventDefault();t.currentTarget;const e=t.pageY;const n=t.pageX;const c=document.querySelector(o);c.style.top=e+"px";c.style.left=n+"px";c.style.display="block"})};const U=()=>{const t=document.querySelector(m);if(t!==null){const e=t.querySelectorAll("li>a");for(const n of e){W(n)}}};const Z=t=>{const e=t.currentTarget;let n=document.querySelector(o);if(n===null){n=window.parent.document.querySelector(o)}if(n&&!n.contains(e)){n.style.display="none"}};const tt=()=>{const t=document.querySelector(s);const e=document.querySelector(l);const n=document.querySelector(r);if(t!==null){t.addEventListener("click",t=>{t.preventDefault();const e=document.querySelector(d);const n=e.getAttribute("data-bs-target");if(n!==null){const c=document.querySelector(n);if(c!==null){const o=c.querySelector("iframe");if(o!==null){o.contentWindow?.location.reload()}}}})}if(e!==null){e.addEventListener("click",t=>{t.preventDefault();F(true)})}if(n){n.addEventListener("click",t=>{t.preventDefault();F(false)})}};const M=(e,n,c)=>{let t=false;const o=document.querySelector(m);const s=document.querySelector(S);const l=o.querySelector("li > a#"+e+"-tab");if(l===null){let t='<li class="nav-item" role="presentation"><a class="nav-link" id="'+e+'-tab" data-bs-toggle="tab" data-bs-target="#'+e+'-tab-content" type="button" role="tab" aria-controls="'+e+'-tab-content" aria-selected="false">'+n+'<button type="button" class="close" aria-label="关闭"><span aria-hidden="true">&times;</span></button></a></li>';b.append(o,t);t='<div class="tab-pane" id="'+e+'-tab-content" role="tabpanel" aria-labelledby="'+e+'-tab" ><iframe src="'+c+'" width="100%" frameborder="no" border="0" marginwidth="0" marginheight="0" ></iframe></div>';b.append(s,t);D(e);N(e);const r=document.querySelector("#"+e+"-tab");W(r);const i=r.querySelector("button.close");T(i)}else{t=true}if(t){const a=l.getAttribute("aria-controls");const u=document.querySelector(a);if(u!==null){const d=u.querySelector("iframe");if(d!==null){d.contentWindow?.location.reload()}}N(a.replace("-tab-content",""))}};const O=t=>{for(const e of t){if(!e.classList.contains(J)){e.addEventListener("click",t=>{t.preventDefault();const e=t.currentTarget;const n=document.querySelectorAll(y+" nav");for(const a of n){const u=a.querySelectorAll("a."+v);if(u!==null){for(const d of u){const f=d.classList;f.remove(v);f.add(p)}}}const c=e.getAttribute("href");const o=e.getAttribute("id");const s=e.querySelector("p")?.textContent;M(o,s,c);const l=e.classList;l.remove(p);l.add(v);const r=b.parents(e,y+" nav>ul>li")[0];const i=e.parentElement;if(r!==i){const m=r.querySelector("a");if(m){const q=m.classList;q.remove(p);q.add(v)}}})}else{e.addEventListener("click",t=>{t.preventDefault();const u=t.currentTarget;const d=u.querySelector("i.xq-menu-expand");if(d!==null){const e=u.parentNode;if(d.classList.contains(x)){const n=e.querySelector("ul");if(n!==null){d.classList.remove(x);d.classList.add(L);if(n.classList.contains("d-none")){n.classList.remove("d-none")}n.classList.add("d-block")}else{let t;t=u.getAttribute("href");if(t!==null){fetch(t).then(async t=>{return t.json()}).then(t=>{let e;e="<ul>";for(const o of t){const s=o.url;const l=o.id;const r=o.name;const i=o.has_submenu;if(i){e+='<li class="nav-item"><a href="'+s+'" class="nav-link xq-menu" id="t_'+l+'">';e+='<i class="nav-icon bi bi-circle"></i><p>'+r+'</p><span class="float-end"><i class="bi xq-menu-expand '+x+'"></i></span>';e+="</a></li>"}else{e+='<li class="nav-item"><a href="'+s+'" class="nav-link" id="t_'+l+'">';e+='<i class="nav-icon bi bi-record-circle"></i><p>'+r+"</p>";e+="</a></li>"}}e+="</ul>";b.after(u,e);const n=u.parentNode;const c=n.querySelector("ul");d.classList.remove(x);d.classList.add(L);if(c!==null){if(c.classList.contains("d-none")){c.classList.remove("d-none")}c.classList.add("d-block");const a=c.querySelectorAll("a");O(a)}}).catch(()=>{console.log("url:"+t+",fetch error")})}}}else if(e!==null){const n=e.querySelector("ul");if(n!==null){if(n.classList.contains("d-block")){n.classList.remove("d-block")}n.classList.add("d-none");if(d.classList.contains(L)){d.classList.remove(L)}d.classList.add(x)}}}})}}};const et=()=>{G();K();const t=document.querySelectorAll(y+" a:not("+g+")");O(t);A()};const nt=()=>{const t=document.fullscreenElement??document.msFullscreenElement??document.mozFullScreenElement??document.webkitFullscreenElement??false;if(!t){const e=document.documentElement;const n=e.requestFullScreen||e.webkitRequestFullScreen||e.mozRequestFullScreen||e.msRequestFullScreen;if(n){n.call(e)}}else{const c=document.exitFullscreen||document.webkitExitFullscreen||document.msExitFullscreen;if(c){c.call(document)}}};const ct=()=>{const t=document.querySelector(e);if(t!==null){t.addEventListener("click",t=>{t.preventDefault();nt()})}};const I=()=>{const t=document.querySelector(m);const e=t.querySelector(".active");return e};const ot=()=>{const t=document.querySelector(f);const e=document.querySelector(m);const n=e.querySelector("li:first-child");const c=Math.abs(Number.parseInt(n.style.marginLeft,10));const o=Number.isNaN(c)?0:c;const s=e.clientWidth+o;const l=t.clientWidth;let r=0;if(s>l){const i=I();const a=e.querySelectorAll("li>a");let t=0;for(const d of a){if(d===i){break}t+=d.clientWidth}const u=s-l;r=t>u?u:t;n.style.marginLeft=(-r).toString()+"px"}else{n.style.marginLeft="0px"}};const st=()=>{const t=document.querySelector(f);const e=document.querySelector(m);const n=e.querySelector("li:first-child");const c=Number.isNaN(Number.parseInt(n.style.marginLeft,10))?0:Number.parseInt(n.style.marginLeft,10);const o=Math.abs(c);const s=e.clientWidth+o;const l=t.clientWidth;let r=0;if(s>l){const i=I();const a=e.querySelectorAll("li>a");let t=0;for(const u of a){t+=u.clientWidth;if(u===i){break}}if(c<0){r=l-t;n.style.marginLeft=r<0?r.toString()+"px":"0px"}}else{n.style.marginLeft="0px"}};const lt=()=>{const t=document.querySelector(n);if(t!==null){t.addEventListener("click",t=>{t.preventDefault();ot()})}};const rt=()=>{const t=document.querySelector(c);if(t!==null){t.addEventListener("click",t=>{t.preventDefault();st()})}};const it=()=>{ct();lt();rt();U();const{body:t}=document;t.addEventListener("click",t=>{Z(t)});tt()};const at=()=>{window.addEventListener("message",t=>{const e=t.data;const n=e.callback;const c=e.params;if(Object.hasOwn(window,n)){const o=window[n];o.apply(null,c)}})};const ut=()=>{_();V();A();w();Q();X();et();it();at()};b.domReady(()=>{ut()});window.xqAddTab=M})();